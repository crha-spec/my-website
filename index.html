<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Müzik Uygulaması</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
</head>
<body>
  <!-- Admin Paneli -->
  <div id="admin-panel" style="display:none;">
    <h2>🎵 Admin Paneli</h2>
    <input id="song-name" placeholder="Şarkı Adı"><br>
    <input id="song-artist" placeholder="Sanatçı"><br>
    <input id="song-url" placeholder="Şarkı URL (mp3/catbox)"><br>
    <button onclick="addSong()">Şarkıyı Ekle</button>
    <hr>
  </div>

  <!-- Kullanıcı Paneli -->
  <div id="user-panel" style="display:none;">
    <h2>📀 Şarkı Listesi</h2>
    <ul id="songs-list"></ul>
    <p id="user-ip" style="margin-top:20px; color:gray; font-size:14px;"></p>
  </div>

  <script>
    // 🔑 Supabase bilgilerin
    const SUPABASE_URL = "https://zzlrltqrzxjwmtpuvhsi.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp6bHJsdHFyenhqd210cHV2aHNpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1MzU1MTEsImV4cCI6MjA3MzExMTUxMX0.nEW-3ctSbAaQj-d-I01AzkvTM70QzoXBiZmHdC1Yv8g";
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // 🔑 Admin IP
    const ADMIN_IP = "151.250.4.2";

    // IP kontrolü
    async function checkIP() {
      try {
        const res = await fetch("https://api64.ipify.org?format=json");
        const data = await res.json();
        console.log("Senin IP:", data.ip);

        if (data.ip === ADMIN_IP) {
          document.getElementById("admin-panel").style.display = "block";
        } else {
          document.getElementById("user-panel").style.display = "block";
          document.getElementById("user-ip").innerText = "Senin IP adresin: " + data.ip;
        }
        loadSongs();
      } catch (err) {
        console.error("IP kontrol hatası:", err);
      }
    }

    // Şarkı ekleme
    async function addSong() {
      const name = document.getElementById("song-name").value;
      const artist = document.getElementById("song-artist").value;
      const url = document.getElementById("song-url").value;

      if (!name || !artist || !url) {
        alert("Lütfen tüm alanları doldurun!");
        return;
      }

      const { error } = await supabase.from("Songs").insert([{ name, artist, url }]);

      if (error) {
        alert("Hata: " + error.message);
      } else {
        alert("✅ Şarkı eklendi!");
        document.getElementById("song-name").value = "";
        document.getElementById("song-artist").value = "";
        document.getElementById("song-url").value = "";
        loadSongs();
      }
    }

    // Şarkı listesi yükleme
    async function loadSongs() {
      const { data, error } = await supabase.from("Songs").select("*").order("id", { ascending: false });
      const list = document.getElementById("songs-list");
      list.innerHTML = "";

      if (error) {
        console.error(error);
        return;
      }

      data.forEach(song => {
        const li = document.createElement("li");
        li.innerHTML = `
          <b>${song.name}</b> - ${song.artist}<br>
          <audio controls src="${song.url}"></audio>
          <hr>`;
        list.appendChild(li);
      });
    }

    // Çalıştır
    checkIP();
  </script>
</body>
</html>
