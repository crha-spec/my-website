<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>MÃ¼zik KitaplÄ±ÄŸÄ±</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin:20px; background:#f4f4f4; }
    h1 { color:#333; }
    .song, .request { background:#fff; padding:10px; margin:10px 0; border-radius:5px; }
    .admin { background:#eef; padding:10px; margin:10px 0; border-radius:5px; }
    button { padding:5px 10px; margin-top:5px; }
    input, textarea { display:block; margin:5px 0; padding:5px; width:100%; }
  </style>
</head>
<body>
  <h1 id="title">MÃ¼zik KitaplÄ±ÄŸÄ±</h1>
  <div id="songs"></div>

  <!-- Dinleyici ÅarkÄ± Ä°stek Formu -->
  <div id="request-form">
    <h2>ğŸµ ÅarkÄ± Ä°ste</h2>
    <input type="text" id="reqName" placeholder="ÅarkÄ± adÄ±">
    <input type="text" id="reqArtist" placeholder="SanatÃ§Ä± adÄ±">
    <input type="text" id="reqFile" placeholder="ÅarkÄ± dosyasÄ± linki (Google Drive, Dropbox vs)">
    <button onclick="sendRequest()">Ä°stek GÃ¶nder</button>
    <p id="reqMessage"></p>
  </div>

  <!-- Admin Paneli -->
  <div id="admin" style="display:none;">
    <h2>âš™ï¸ Admin Paneli</h2>
    <div>
      <h3>Yeni ÅarkÄ± Ekle</h3>
      <input type="text" id="songName" placeholder="ÅarkÄ± adÄ±">
      <input type="text" id="songArtist" placeholder="SanatÃ§Ä±">
      <input type="text" id="songUrl" placeholder="Catbox URL">
      <button onclick="addSong()">Ekle</button>
      <p id="adminMessage"></p>
    </div>
    <div>
      <h3>ğŸ“¥ ÅarkÄ± Ä°stekleri</h3>
      <div id="requests"></div>
    </div>
  </div>

<script>
  // ğŸ”‘ Senin Supabase bilgilerin
  const SUPABASE_URL = "https://zzlrltqrzxjwmtpuvhsi.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp6bHJsdHFyenhqd210cHV2aHNpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1MzU1MTEsImV4cCI6MjA3MzExMTUxMX0.nEW-3ctSbAaQj-d-I01AzkvTM70QzoXBiZmHdC1Yv8g";
  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  const ADMIN_IP = "151.250.4.2"; // sadece senin ip
  let userIp = "";

  // KullanÄ±cÄ±nÄ±n IP'sini al
  async function checkIP() {
    try {
      const res = await fetch("https://api64.ipify.org?format=json");
      const data = await res.json();
      userIp = data.ip;
      if (userIp === ADMIN_IP) {
        document.getElementById("admin").style.display = "block";
        document.getElementById("title").innerText = "Admin KitaplÄ±ÄŸÄ±";
        loadRequests();
      }
    } catch(e) { console.error("IP alÄ±namadÄ±", e); }
  }

  // ÅarkÄ±larÄ± yÃ¼kle
  async function loadSongs() {
    const { data, error } = await supabase.from("Songs").select("*").order("id", { ascending: false });
    if (error) { console.error(error); return; }
    const songsDiv = document.getElementById("songs");
    songsDiv.innerHTML = "";
    data.forEach(song => {
      songsDiv.innerHTML += `<div class="song">
        <b>${song.name}</b> - ${song.artist}<br>
        <audio controls src="${song.url}"></audio>
      </div>`;
    });
  }

  // ÅarkÄ± ekle (Admin)
  async function addSong() {
    const name = document.getElementById("songName").value;
    const artist = document.getElementById("songArtist").value;
    const url = document.getElementById("songUrl").value;
    const { error } = await supabase.from("Songs").insert([{ name, artist, url }]);
    document.getElementById("adminMessage").innerText = error ? "Hata: "+error.message : "Eklendi!";
    loadSongs();
  }

  // ÅarkÄ± isteÄŸi gÃ¶nder (Dinleyici)
  async function sendRequest() {
    const name = document.getElementById("reqName").value;
    const artist = document.getElementById("reqArtist").value;
    const file_url = document.getElementById("reqFile").value;
    const { error } = await supabase.from("SongRequests").insert([{ name, artist, file_url, user_ip: userIp }]);
    document.getElementById("reqMessage").innerText = error ? "Hata: "+error.message : "Ä°stek gÃ¶nderildi!";
  }

  // ÅarkÄ± isteklerini yÃ¼kle (Admin)
  async function loadRequests() {
    const { data, error } = await supabase.from("SongRequests").select("*").order("id", { ascending: false });
    if (error) { console.error(error); return; }
    const reqDiv = document.getElementById("requests");
    reqDiv.innerHTML = "";
    data.forEach(r => {
      reqDiv.innerHTML += `<div class="request">
        <b>${r.name}</b> - ${r.artist}<br>
        Dosya: <a href="${r.file_url}" target="_blank">Ä°ndir</a><br>
        KullanÄ±cÄ± IP: ${r.user_ip || "Bilinmiyor"}<br>
        Tarih: ${r.created_at}
      </div>`;
    });
  }

  checkIP();
  loadSongs();
</script>
</body>
</html>
